# RiskRadar: Early Detection of Diabetes with Patient Data

**Author:** Naseefah Chowdhury  
**Program:** Morehouse College Machine Learning Technician Postbaccalaureate Program  
**Institution:** Center for Broadening Participation in Computing  

> **Note:** This repository is for research/education. It is **not** a medical device or clinical tool.

---

## Overview
This project predicts the likelihood of diabetes for an individual using demographic and health-related features. The goal is to support healthcare professionals and researchers in identifying at-risk individuals early.

- **Stakeholder:** Healthcare providers and researchers  
- **Decision supported:** Early detection of diabetes risk to guide prevention and treatment strategies

---

## Dataset
- **Source:** Diabetes Prediction Dataset on Kaggle — https://www.kaggle.com/datasets/iammustafatz/diabetes-prediction-dataset  
- **License:** Data files © Original Authors (per Kaggle page)  
- **Size:** ~100,000 rows

### About (from the dataset)
The Diabetes prediction dataset is a collection of medical and demographic data from patients, along with their diabetes status (positive or negative). The data includes features such as age, gender, body mass index (BMI), hypertension, heart disease, smoking history, HbA1c level, and blood glucose level. This dataset can be used to build machine learning models to predict diabetes in patients based on their medical history and demographic information. This can be useful for healthcare professionals in identifying patients who may be at risk of developing diabetes and in developing personalized treatment plans. Additionally, the dataset can be used by researchers to explore the relationships between various medical and demographic factors and the likelihood of developing diabetes.

### Schema & Fields
- `gender` — Biological sex: *Female*, *Male*, *Other*  
- `age` — Numeric; typically 0–80 in the source dataset  
- `hypertension` — 0 = No, 1 = Yes  
- `heart_disease` — 0 = No, 1 = Yes  
- `smoking_history` — *not current*, *former*, *never*, *ever*, *No Info*  
- `bmi` — Body Mass Index (approx. 10.16–71.55 in dataset)  
- `HbA1c_level` — Hemoglobin A1c (%) — long-term blood glucose  
- `blood_glucose_level` — Blood sugar level (mg/dL)  
- `diabetes` — Target, 0 = No, 1 = Diabetes

### Filters / Cleaning Applied
- Removed exact duplicates  
- **Age validation:** kept ages in **[0, 120]**
- **BMI cap:** ≤ 60  
- **HbA1c range:** [3, 20]  
- **Blood glucose range:** [50, 400]  
- Encoded categoricals (`gender`, `smoking_history`) via mapping encoding

### Accessing the Data (Kaggle API)
~~~bash
# 1) Install dependencies (after creating & activating a venv; see Reproducibility)
pip install kaggle

# 2) Place your Kaggle API token at: ~/.kaggle/kaggle.json
#    (Kaggle: Account > Create New API Token)

# 3) Download to data/raw and unzip
mkdir -p data/raw
kaggle datasets download -d iammustafatz/diabetes-prediction-dataset -p data/raw --unzip
~~~

---

## Methods

### Preprocessing
- Validation ranges/capping (see above)  
- Mapping (label) encoding for `gender` and `smoking_history`  
- **Stratified** train/test split (80/20)  
- Leakage prevention: transforms fit on **train only**, then applied to validation/test

### Models
- **Baseline:** Logistic Regression  
- **Improved:** XGBoost Classifier (gradient-boosted decision trees)

### Optimization
- Hyperparameter search (`GridSearchCV`) over:
  - `max_depth`, `learning_rate`, `n_estimators`
- **Threshold tuning** on validation to target **recall ≥ 0.80**  
  - Selected probability threshold: **0.21**

### Validation & Metrics
- Hold-out stratified train/test  
- Metrics: **Precision**, **Recall**, **F1**, **Accuracy**, **ROC-AUC**  
- Emphasis on **Recall** to reduce missed true diabetic cases

---

## Results

### Final Model — XGBoost (optimized, threshold tuned)
- **Threshold:** 0.21  
- **Precision:** 0.74  
- **Recall:** 0.81  
- **F1-score:** 0.77  
- **Accuracy:** 0.96  
- **ROC-AUC:** 0.97897


**Confusion Matrix (test set):**
~~~text
[[TN=17040   FP=474]
 [FN=327     TP=1362]]
~~~

**Practical Meaning of Errors**
- **False Negatives (327):** likely diabetic individuals the model missed → risk of delayed care  
- **False Positives (474):** non-diabetic individuals flagged → potential unnecessary follow-up

### Baseline vs. Improved


| Model                      | Precision | Recall | F1   | Accuracy | ROC-AUC |
|----------------------------|-----------|--------|------|----------|---------|
| Logistic Regression        | 0.87      | 0.63   | 0.73 | 0.96     | 0.960   |
| XGBoost (threshold = .21)  | 0.74      | 0.81   | 0.77 | 0.96     | 0.97897 |



> **Interpretation:** XGBoost trades some precision for higher recall, aligning with the healthcare goal of catching more at-risk individuals.

### Suggested Figures (auto-generated by code)
- `results/roc_curve.png` — ROC curve  
- `results/precision_recall_curve.png` — Precision–Recall curve (mark chosen threshold)  
- `results/feature_importance.png` — XGBoost feature importances  
- `results/confusion_matrix.png` — Confusion matrix heatmap



---

## Reproducibility

### Environment Setup
~~~bash
# (optional on HPCs)
module load python/3.9

python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
~~~

### Run the Pipeline
~~~bash
python src/main.py
~~~

### Run on TACC (Stampede3)

```bash
# from the project root on Stampede3
cd slurm
sbatch job.slurm                # submit the job
squeue -u <your_username>       # check job status

# view logs when finished
cd ../logs
cat output_<JOBID>.out          # stdout (install logs, metrics)
cat error_<JOBID>.err           # stderr (should be empty if no errors)
```

`slurm/job.slurm`:
```bash
#!/bin/bash
#SBATCH -J diabetes-xgb
#SBATCH -o ../logs/output_%j.out
#SBATCH -e ../logs/error_%j.err
#SBATCH -N 1
#SBATCH -n 1
#SBATCH -p skx-dev
#SBATCH -t 01:00:00

set -e

# ensure logs directory exists (relative to slurm/)
mkdir -p ../logs

module load python/3.9
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r ../requirements.txt

python ../src/main.py
```


### Seeds & Versions
- **Random seed:** `42` (`random_state=42` in splits/models)  
- **Split strategy:** Stratified 80/20  
- **Dataset version/date:** record the Kaggle download date or version



---
## Requirements

Pinned to the **exact versions** used on Stampede3 (from logs):

```text
pandas==2.3.2
numpy==2.0.2
scikit-learn==1.6.1
xgboost==2.1.4
matplotlib==3.8.4
```

---
## Repository Structure 
```text
.
├── data/
│   ├── raw/
│   └── processed/
├── results/
│   ├── metrics_*.csv
│   ├── roc_curve.png
│   ├── precision_recall_curve.png
│   ├── feature_importance.png
│   ├── confusion_matrix.png
│   └── poster.pdf
├── src/
│   └── main.py
├── slurm/
│   └── job.slurm
├── logs/
├── requirements.txt
└── README.md

```

## Poster
[Download the poster (PDF)](results/poster.pdf)
[View the final poster (PDF)](results/poster.pdf)

## Deployment

### Local Demo (Train & Evaluate)
Run the full training pipeline locally on the Kaggle dataset.  
This will preprocess the data, train an XGBoost model, tune the threshold, and save results/plots.

```bash
# Clone repo and move inside
git clone https://github.com/NaseefahC/Diabetes-Prediction.git
cd Diabetes-Prediction

# (optional) create virtual environment
python3 -m venv venv
source venv/bin/activate

# Install requirements
pip install -r requirements.txt

# Run the pipeline (default dataset + training)
python src/main.py
```


## Ethical Considerations
- **Bias:** Some demographics may be overrepresented; the model must be fair across groups.  
- **Privacy:** The dataset contains sensitive health information.  
- **Fairness:** Evaluate performance across demographic groups to avoid unintended harm (e.g., check precision/recall by gender and age buckets and compare FNR/TPR gaps).  
- **Misuse:** Predictions should only be used for risk assessment, not diagnosis.

---

## Acknowledgments
- Mentors at the **Morehouse College Machine Learning Technician Postbaccalaureate Program**  
- The **Center for Broadening Participation in Computing**  
- **Kaggle** and the dataset contributor

---


## Citation:  
Mustafa Tariq. *Diabetes Prediction Dataset.* Kaggle.  
https://www.kaggle.com/datasets/iammustafatz/diabetes-prediction-dataset





